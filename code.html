<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Raw Accel LUT Maker</title>

<style>
body {
  font-family: Arial;
  background:#111;
  color:white;
  text-align:center;
}

canvas {
  background:#000;
  border:1px solid #444;
  margin-top:10px;
  cursor:crosshair;
}

input {
  margin:4px;
  padding:4px;
  width:90px;
}

button {
  padding:6px 10px;
  margin:5px;
  background:#222;
  color:white;
  border:1px solid #555;
}
textarea {
  width:90%;
  height:120px;
  background:#000;
  color:#0f0;
  margin-top:10px;
}
</style>
</head>

<body>

<h2>Raw Accel LUT Maker</h2>

<div>
DPI <input id="dpi" value="800">
Polling Rate <input id="poll" value="1000">
Mouse Scale <input id="scale" value="1">
</div>

<canvas id="graph" width="800" height="400"></canvas>

<br>

<button onclick="resetLine()">Reset Straight Line</button>
<button onclick="exportLUT()">Export LUT</button>
<button onclick="triplePhase()">Triple Phase LUT</button>

<textarea id="output"></textarea>

<script>
const canvas = document.getElementById("graph");
const ctx = canvas.getContext("2d");

let points = [
  {x:0,y:1},
  {x:100,y:1}
];

let dragging = null;

function getScale(){
  return Number(document.getElementById("scale").value)||1;
}

function dpi(){
  return Number(document.getElementById("dpi").value)||800;
}

function poll(){
  return Number(document.getElementById("poll").value)||1000;
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  ctx.strokeStyle="#333";
  for(let i=0;i<10;i++){
    ctx.beginPath();
    ctx.moveTo(0,i*40);
    ctx.lineTo(canvas.width,i*40);
    ctx.stroke();
  }

  ctx.strokeStyle="#0f0";
  ctx.beginPath();

  points.sort((a,b)=>a.x-b.x);

  points.forEach((p,i)=>{
    let px = p.x/100*canvas.width;
    let py = canvas.height-(p.y*canvas.height);

    if(i===0) ctx.moveTo(px,py);
    else ctx.lineTo(px,py);
  });

  ctx.stroke();

  points.forEach(p=>{
    let px=p.x/100*canvas.width;
    let py=canvas.height-(p.y*canvas.height);

    ctx.fillStyle="white";
    ctx.beginPath();
    ctx.arc(px,py,5,0,Math.PI*2);
    ctx.fill();
  });
}

canvas.onmousedown = e=>{
  const rect = canvas.getBoundingClientRect();
  const mx = e.clientX-rect.left;
  const my = e.clientY-rect.top;

  points.forEach((p,i)=>{
    let px=p.x/100*canvas.width;
    let py=canvas.height-(p.y*canvas.height);

    if(Math.hypot(px-mx,py-my)<10){
      dragging=i;
    }
  });
};

canvas.onmousemove = e=>{
  if(dragging===null) return;

  const rect=canvas.getBoundingClientRect();
  let mx=e.clientX-rect.left;
  let my=e.clientY-rect.top;

  mx=Math.max(0,Math.min(canvas.width,mx));
  my=Math.max(0,Math.min(canvas.height,my));

  points[dragging].x=(mx/canvas.width)*100;
  points[dragging].y=1-(my/canvas.height);

  draw();
};

canvas.onmouseup=()=>dragging=null;
canvas.onmouseleave=()=>dragging=null;

canvas.ondblclick=e=>{
  const rect=canvas.getBoundingClientRect();
  const mx=e.clientX-rect.left;
  const my=e.clientY-rect.top;

  points.push({
    x:(mx/canvas.width)*100,
    y:1-(my/canvas.height)
  });

  draw();
};

function resetLine(){
  points=[
    {x:0,y:1},
    {x:100,y:1}
  ];
  draw();
}

function exportLUT(){
  let s=getScale();
  let d=dpi();
  let p=poll();

  points.sort((a,b)=>a.x-b.x);

  let result="";

  points.forEach(pt=>{
    let vel=(pt.x*s*d/p).toFixed(3);
    let gain=pt.y.toFixed(3);
    result+=vel+","+gain+";";
  });

  document.getElementById("output").value=result;
}

function triplePhase(){
  let s=getScale();
  let d=dpi();
  let p=poll();

  let result="";
  let start=0;
  let end=100;

  result+= (start*s*d/p).toFixed(3)+",1.000;";
  result+= (end*s*d/p).toFixed(3)+",1.000;";

  document.getElementById("output").value=result;
}

draw();
</script>

</body>
</html>
