<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Triple Phase LUT Calculator</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
background:#000;
color:#fff;
font-family:Arial;
margin:0;
}

header{
text-align:center;
padding:25px;
background:linear-gradient(90deg,#111,#000);
}

.logo{
width:90px;
height:90px;
border-radius:50%;
margin-bottom:10px;
box-shadow:0 0 15px rgba(255,255,255,.2);
object-fit:cover;
}

.title{
font-size:28px;
font-weight:bold;
letter-spacing:2px;
}

.credit{
font-size:14px;
color:#aaa;
}

.container{
max-width:1000px;
margin:auto;
padding:20px;
}

.card{
background:#111;
border-radius:15px;
padding:20px;
margin-bottom:20px;
}

label{
display:block;
margin-top:12px;
}

input{
width:100%;
padding:8px;
margin-top:5px;
background:#000;
border:1px solid #333;
color:#fff;
border-radius:6px;
}

button{
margin-top:15px;
padding:12px;
width:100%;
border:none;
background:#fff;
color:#000;
font-weight:bold;
border-radius:8px;
cursor:pointer;
}

textarea{
width:100%;
height:180px;
background:#000;
color:#fff;
border:1px solid #333;
border-radius:8px;
padding:10px;
margin-top:15px;
font-family:monospace;
}
</style>
</head>

<body>

<header>
<img class="logo"
src="https://yt3.googleusercontent.com/G3NBG71dzJtbQ3ae2ERcVDRvXGEHaAlCO43-fnO-uilXeikc5mYWp2p2k4owzc4S5n0brzNC=s160-c-k-c0x00ffffff-no-rj">

<div class="title">Triple Phase LUT Velocity Calculator</div>
<div class="credit">Made by @igneswr</div>
</header>

<div class="container">

<div class="card">

<label>Input Range</label>
<input id="input_range" value="257">

<label>Phase 1 Velocity</label>
<input id="phase1_velocity" value="6.6">

<label>Phase 2 Velocity</label>
<input id="phase2_velocity" value="23">

<label>Phase 3 Velocity</label>
<input id="phase3_velocity" value="53">

<label>Phase 1 Cap</label>
<input id="phase1_cap" value="60">

<label>Phase 2 Start</label>
<input id="phase2_start" value="152">

<label>Phase 3 Start</label>
<input id="phase3_start" value="180">

<label>Smooth Factor</label>
<input id="smooth_factor" value="0.1">

<button onclick="generateCurve()">Generate LUT</button>
<button onclick="copyLUT()">Copy LUT</button>

<textarea id="lutOutput"></textarea>

</div>

<div class="card">
<h2>Velocity Graph</h2>
<canvas id="chart"></canvas>
</div>

</div>

<script>

let chart;
let lutData=[];

/* ===== ELEMENT REFERENCES ===== */

const input_rangeEl=document.getElementById("input_range");
const phase1_velocityEl=document.getElementById("phase1_velocity");
const phase2_velocityEl=document.getElementById("phase2_velocity");
const phase3_velocityEl=document.getElementById("phase3_velocity");
const phase1_capEl=document.getElementById("phase1_cap");
const phase2_startEl=document.getElementById("phase2_start");
const phase3_startEl=document.getElementById("phase3_start");
const smooth_factorEl=document.getElementById("smooth_factor");

const chartEl=document.getElementById("chart");
const lutOutput=document.getElementById("lutOutput");

/* ===== SIGMOID ===== */

function sigmoid(x){
return 1/(1+Math.exp(-x));
}

/* ===== RAW ACCEL AUTO FIX ===== */

function autoFixLUT(data){

let fixed=[];
fixed.push({x:0.001,y:1});

let lastX=0.001;

for(let p of data){

if(!isFinite(p.x)||!isFinite(p.y)) continue;

p.x=Math.max(0.001,p.x);
p.y=Math.max(0,Math.min(5,p.y));

if(p.x<=lastX)
p.x=lastX+0.001;

fixed.push(p);
lastX=p.x;
}

fixed.push({x:100,y:1});
return fixed;
}

/* ===== GENERATE CURVE ===== */

function generateCurve(){

const input_range=Number(input_rangeEl.value);
const p1v=Number(phase1_velocityEl.value);
const p2v=Number(phase2_velocityEl.value);
const p3v=Number(phase3_velocityEl.value);
const p1cap=Number(phase1_capEl.value);
const p2start=Number(phase2_startEl.value);
const p3start=Number(phase3_startEl.value);
const smooth=Number(smooth_factorEl.value);

if(!input_range||input_range<=0){
alert("Invalid input range");
return;
}

let raw=[];
let xValues=[];
let yValues=[];

for(let x=1;x<=input_range;x++){

let y;

if(x<=p1cap){
y=(p1v/p1cap)*x;
}
else if(x<p2start){
let mid=(p1cap+p2start)/2;
let t=sigmoid(smooth*(x-mid));
y=p1v+(p2v-p1v)*t;
}
else if(x<p3start){
let mid=(p2start+p3start)/2;
let t=sigmoid(smooth*(x-mid));
y=p2v+(p3v-p2v)*t;
}
else{
y=p3v;
}

raw.push({x,y});
xValues.push(x);
yValues.push(y);
}

const safe=autoFixLUT(raw);

lutData=safe.map(p=>`${p.x.toFixed(3)},${p.y.toFixed(3)};`);
lutOutput.value=lutData.join("\n");

drawChart(xValues,yValues);
}

/* ===== DRAW GRAPH ===== */

function drawChart(x,y){

if(chart) chart.destroy();

chart=new Chart(chartEl,{
type:"line",
data:{
labels:x,
datasets:[{
label:"Velocity Curve",
data:y,
borderColor:"white",
borderWidth:2,
pointRadius:0
}]
},
options:{
plugins:{legend:{labels:{color:"white"}}},
scales:{
x:{ticks:{color:"white"},grid:{color:"#222"}},
y:{ticks:{color:"white"},grid:{color:"#222"}}
}
}
});
}

/* ===== COPY ===== */

function copyLUT(){

if(!lutOutput.value){
alert("Generate LUT first");
return;
}

lutOutput.select();
document.execCommand("copy");
alert("Copied");
}

</script>

</body>
</html>
